<link rel="stylesheet" type="text/css" href="../../lib/jquery_ender/modulos/Selector.css" />

<script type="text/javascript">

	function SeleccionarRegistro()
	{
		$(this).parent().parent().parent().AsignarRegistro($(this).parent().attr('idSeleccionadoBusqueda'));
    	$(this).parent().parent().parent().find('.ResultadoBusqueda:first').fadeOut();
	}
	
	function CrearRegistro() {
		$(this).parent().parent().find('.AccionActiva').attr('idRegistro', '-1');
    	$(this).parent().parent().parent().find('.ResultadoBusqueda:first').fadeOut();
		$(this).parent().parent().EditarRegistro();		
	}

	function ProcesarResultadoBusqueda(ResultadoBusqueda, respuesta, selector)
	{
			ResultadoBusqueda.html('');						

			eval('var registros = '+respuesta);
			var NPersonal = registros.length;
			
			if (NPersonal > 0)
			{
					FilaResultado = ResultadoBusqueda.find('.FilaResultado');
					
					for(i=0;i<NPersonal;i++) 
					{	
						var registro=registros[i];
						var fila={};
						
						for(var indice in registro)
						{
							var propiedad=registro[indice];
							
							for(var IndicePropiedad in propiedad)
							{
								fila[IndicePropiedad]=propiedad[IndicePropiedad];	
							}
							
						} // recorremos el resultado
							var htmlResultado=selector.getHTMLResultado(fila, i, selector.attr('campofiltrado'));						
							ResultadoBusqueda.append(htmlResultado);
						
						
					}						

					ResultadoBusqueda.find('.ColumnaSeleccionar').unbind('click');
					ResultadoBusqueda.find('.ColumnaSeleccionar').bind('click',SeleccionarRegistro);
						
					ResultadoBusqueda.fadeIn();
					CierraBarraProgreso();
			}
	}

	function BuscarRegistro(event)
	{
		if( event.keyCode!=null && event.keyCode!=13 )
		{
			return false;
		}

		var selector = $(this).parent().parent();
		var TerminoBusqueda 	= $(this).parent().find('.busqueda').val();
		var nombretabla 		= selector.attr('tabla');
		var ResultadoBusqueda 	= selector.find('.ResultadoBusqueda:first');
		InicializaBarraProgreso();

		$.get('../../scripts/buscar.py',{busqueda:TerminoBusqueda, tabla:nombretabla},
			function(respuesta)
			{
				selector.Log('Llamando a procesarresultadobusqueda' );
				ProcesarResultadoBusqueda(ResultadoBusqueda, respuesta, selector);
			}
		); 
	}

</script>

<div class="CajaBusqueda">
<div class="TituloSelector" ></div>
	<input value="" title="busqueda" size="35" class="busqueda" name="busqueda" maxlength="2048"/>
	<a href='#' class="BotonBuscar">buscar</a>
	<a href="#" class="BotonCrear">nuevo</a>
</div>
<div class="CajaSelector Seleccionado" />
<div class="CajaSelector ResultadoBusqueda" />
<div class="CajaSelector CajaDatos AccionActiva" />
<div class="Dialogo" />
